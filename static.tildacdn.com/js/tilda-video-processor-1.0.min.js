function setWidthHeightHTMLVideo(e,t){console.log("setWidthHeightHTMLVideo:"+t);var o=e.closest(".t-cover__carrier");t+="";var i,n,s,r,a=o.find("video"),d=o.attr("data-content-video-nocover"),p=o.attr("data-content-video-ratio"),h=.5625;0<p&&(h=+parseFloat(p)),"yes"!=d?(n=-1<(t=t||"100vh").indexOf("vh")?(i=(i=window.innerHeight)||$(window).height(),Math.floor(i*(parseInt(t)/100))):parseInt(t),p=r=(s=(s=Math.floor(parseInt(window.innerWidth)))||$(window).width())*h,d=r<n?r<n?n/r+.02:r/n+.02:1,i=Math.floor(s*d),n=(d=Math.floor(p*d))-n,s=i-s,a.height(d+"px"),a.width(i+"px"),e.height(d+"px"),e.width(i+"px"),0<n?a.css("margin-top",-Math.floor(n/2)+"px"):a.css("margin-top",0),0<s?a.css("margin-left",-Math.floor(s/2)+"px"):a.css("margin-left",0)):(t||(r=Math.floor(o.width()*h)),t&&-1<t.indexOf("vh")?r=Math.floor(window.innerHeight*(parseInt(t)/100)):t&&(r=parseInt(t)),a.css("width","100%"),a.height(r+"px"))}function processSrc(e,t,o){-1===e.indexOf("https://www.youtube.com/embed")&&(e="https://www.youtube.com/embed"+("/"===e[0]?e:"/"+e)),-1!==e.indexOf("?")?e+="&":e+="?";var i=location.protocol+"//"+location.host;return e="yes"!=t?(e[e.length-1],e+"autoplay=1&loop=1&enablejsapi=1&&playerapiid=featuredytplayer&controls=0&modestbranding=1&rel=0&showinfo=0&color=white&iv_load_policy=3&theme=light&wmode=transparent&origin="+i+"&playlist="+function(e){for(var t=e.split("/"),o=null,i=0,n=t.length;i<n;i++)"embed"===t[i]&&(o=t[i+1]);return-1!==o.indexOf("?")&&(o=o.split("?")[0]),o}(e)):(e[e.length-1],e+"autoplay=0&loop=0&enablejsapi=1&&playerapiid=featuredytplayer&controls=1&modestbranding=1&rel=0&showinfo=0&color=black&iv_load_policy=3&theme=dark&wmode=transparent&origin="+i),"yes"!==o&&(e+="&mute=1"),e}function onYouTubePlayerReady_do(e,t,o){var i,n=$(window),s=$(e),r=0;n.scroll(function(){i&&(window.clearTimeout(i),15<=r&&(timer_player_do(s,n,t,o),r=0),r++),i=window.setTimeout(function(){timer_player_do(s,n,t,o),r=0},100)}),n.scroll()}function timer_player_do(e,t,o,i){var n=e.offset().top,s=e.height(),r=t.scrollTop(),e=t.height(),t=o.getPlayerState();n<r+e&&r<=n+s?(1!==t&&o.playVideo(),"yes"==i&&(n+s-100<r?o.setVolume(30):n+s-200<r?o.setVolume(70):r+e<n+200?o.setVolume(30):o.setVolume(100))):r+e<n&&n-500<r+e?2!==t&&(o.playVideo(),o.pauseVideo()):2!==t&&o.pauseVideo()}function load_youtube_api(){var e,t;"yes"!==window.loadytapi_flag&&(window.loadytapi_flag="yes",(e=document.createElement("script")).src="https://www.youtube.com/iframe_api",(t=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,t))}function setWidthHeightYoutubeVideo(e,t){console.log("setWidthHeightYoutubeVideo:"+t);var o,i,n,s,r=(e=$(e)).find("iframe"),a=e.attr("data-content-video-nocover"),d=e.attr("data-content-video-noadcut-youtube"),p=e.attr("data-content-video-ratio"),h=.5625;0<p&&(h=+parseFloat(p)),"yes"!=a?(i=-1<(t=t||"100vh").indexOf("vh")?(o=(o=window.innerHeight)||$(window).height(),Math.floor(o*(parseInt(t)/100))):parseInt(t),p=s=(n=(n=Math.floor(parseInt(window.innerWidth)))||$(window).width())*h,a=s,o=1,"yes"!=d&&(p=p+110+110,a=s-220),a<i&&(o=s<i?i/s+.02:s/i+.02),a=Math.floor(n*o),i=(o=Math.floor(p*o))-i,n=a-n,r.height(o+"px"),r.width(a+"px"),0<i&&r.css("margin-top",-Math.floor(i/2)+"px"),0<n&&r.css("margin-left",-Math.floor(n/2)+"px")):(t||(s=Math.floor(e.width()*h)),t&&-1<t.indexOf("vh")?s=Math.floor(window.innerHeight*(parseInt(t)/100)):t&&(s=parseInt(t)),r.css("width","100%"),r.height(s+"px"))}!function(p){var e=p.Deferred();window.processYoutubeVideo=function(a,d){load_youtube_api();e.then(function(){var t,e=p(a),o=e.attr("data-content-video-url-youtube"),i=e.attr("data-content-video-nomute"),n=e.attr("data-content-video-noloop"),s=e.attr("data-content-video-nocover"),r=document.createElement("iframe");r.src=processSrc(o,s,i),r.frameBorder=0,r.allow="autoplay",a.appendChild(r),window.isMobile||new YT.Player(r,{events:{onReady:function(e){onYouTubePlayerReady_do(a,e.target,i),e.target.setVolume&&"yes"!=i&&e.target.setVolume(0),e.target.setLoop(!0)},onStateChange:function(o){var e;o.target.setVolume&&"yes"!=i&&o.target.setVolume(0),-1!==o.data||0<=(e=window.fix_scrolltop_beforestop_youtube)&&(p("html, body").scrollTop(e),delete window.fix_scrolltop_beforestop_youtube),o.data===YT.PlayerState.PLAYING?t=window.setInterval(function(){var e=o.target.getCurrentTime(),t=o.target.getDuration();t<e+1&&0!==t&&(o.target.seekTo(0),"yes"===n&&(o.target.stopVideo(),o.target.clearVideo()))},1e3):window.clearInterval(t)}}}),setWidthHeightYoutubeVideo(e,d)})},window.onYouTubeIframeAPIReady=function(){e.resolve()},p.fn.videoBG=function(e,t){t={};if("object"==typeof e)t=p.extend({},p.fn.videoBG.defaults,e);else{if(e)return p(e).videoBG(t);t=p.fn.videoBG.defaults}var o=p(this);if(o.length){"static"!=o.css("position")&&o.css("position")||o.css("position","relative"),0==t.width&&(t.width=o.width()),0==t.height&&(t.height=o.height()),t.textReplacement&&(t.scale=!0,o.width(t.width).height(t.height).css("text-indent","-9999px"));e=p.fn.videoBG.video(t);return t.scale&&e.height(t.height).width(t.width),o.append(e),void 0===o.attr("data-content-video-nomute")&&o.find("video").prop("muted","true"),setWidthHeightHTMLVideo(e,t.height),e.find("video")[0]}},p.fn.videoBG.setFullscreen=function(e){var t,o=p(window).width(),i=p(window).height();e.css("min-height",0).css("min-width",0),e.parent().width(o).height(i),o/i>e.aspectRatio?(e.width(o).height("auto"),(t=(e.height()-i)/2)<0&&(t=0),e.css("top",-t)):(e.width("auto").height(i),(t=(e.width()-o)/2)<0&&(t=0),e.css("left",-t),0===t&&setTimeout(function(){p.fn.videoBG.setFullscreen(e)},500)),p("body > .videoBG_wrapper").width(o).height(i)},p.fn.videoBG.video=function(e){var t=p("<div/>");t.addClass("videoBG").css("position",e.position).css("z-index",e.zIndex).css("top",0).css("left",0).css("height",e.height).css("width",e.width).css("opacity",e.opacity).css("overflow","hidden");var o,i=p("<video/>");i.css("position","relative").css("z-index",e.zIndex).attr("poster",e.poster).css("top",0).css("left",0).css("min-width","100%").css("min-height","100%"),i.prop("autoplay",e.autoplay),i.prop("loop",e.loop),i.prop("muted",e.muted),0<e.volume?i.prop("volume",e.volume):i.prop("volume",0),e.fullscreen&&(i.bind("canplay",function(){i.aspectRatio=i.width()/i.height(),p.fn.videoBG.setFullscreen(i)}),p(window).resize(function(){clearTimeout(o),o=setTimeout(function(){p.fn.videoBG.setFullscreen(i)},100)}),p.fn.videoBG.setFullscreen(i));var n,s=i[0];e.loop&&(n=e.loop,i.bind("ended",function(){n&&s.play(),!0!==n&&n--})),i.bind("canplay",function(){e.autoplay&&s.play()}),p.fn.videoBG.supportsVideo()&&(p.fn.videoBG.supportType("webm")&&""!=e.webm?i.attr("src",e.webm):p.fn.videoBG.supportType("mp4")&&""!=e.mp4?i.attr("src",e.mp4):i.attr("src",e.ogv));var r=p("<img/>");return r.attr("src",e.poster).css("position","absolute").css("z-index",e.zIndex).css("top",0).css("left",0).css("min-width","100%").css("min-height","100%"),p.fn.videoBG.supportsVideo()?t.html(i):t.html(r),e.textReplacement&&(t.css("min-height",1).css("min-width",1),i.css("min-height",1).css("min-width",1),r.css("min-height",1).css("min-width",1),t.height(e.height).width(e.width),i.height(e.height).width(e.width),r.height(e.height).width(e.width)),p.fn.videoBG.supportsVideo(),t},p.fn.videoBG.supportsVideo=function(){return document.createElement("video").canPlayType},p.fn.videoBG.supportType=function(e){if(!p.fn.videoBG.supportsVideo())return!1;var t=document.createElement("video");switch(e){case"webm":return t.canPlayType('video/webm; codecs="vp8, vorbis"');case"mp4":return t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');case"ogv":return t.canPlayType('video/ogg; codecs="theora, vorbis"')}return!1},p.fn.videoBG.wrapper=function(){var e=p("<div/>");return e.addClass("videoBG_wrapper").css("position","absolute").css("top",0).css("left",0),e},p.fn.videoBG.defaults={mp4:"",ogv:"",webm:"",poster:"",autoplay:!0,loop:!0,scale:!1,position:"absolute",opacity:1,textReplacement:!1,zIndex:0,width:0,height:0,fullscreen:!1,imgFallback:!0}}(jQuery),function(a){function e(){this.setScrollListener()}e.prototype.videoTags=[],e.prototype.defaultConfig={isNeedStop:!1},e.prototype.videoConfigs=[],e.prototype.registerNewVideo=function(e,t){if(!(e instanceof HTMLVideoElement))throw new Error("Wrong tag passed into registerNewVideo");return-1==this.videoTags.indexOf(e)&&(this.videoTags.push(e),this.videoConfigs.push(void 0===t?this.defaultConfig:t),this.scrollCb("",!0),!0)},e.prototype.unergisterVideo=function(e){if(!(e instanceof HTMLVideoElement))throw new Error("Wrong tag passed into unregisterNewVideo");var t;return-1<(t=this.videoTags.indexOf(e))&&("function"==typeof e.remove?e.remove():e.parentNode&&e.parentNode.removeChild(e),this.pauseVideo(e,this.videoConfigs[t]),this.videoTags.splice(t,1),this.videoConfigs.splice(t,1),!0)},e.prototype.pauseVideo=function(e,t){if(!t)throw new Error("Wrong config type!");e.pause(),t.isNeedStop&&e.load()},e.prototype.setScrollListener=function(){a(window).bind("scroll",t_throttle(jQuery.proxy(this.scrollCb,this),200))},e.prototype.scrollCb=function(e,t){for(var o=a(window).height(),i=null,n=0,s=this.videoTags.length;n<s;n++){var r,i=this.videoTags[n];_vrect=this.getVideoBoundingRect(i,!1),Math.abs(_vrect.top)<o&&Math.abs(_vrect.top)>o/2&&(0<(r=1-(Math.abs(_vrect.top)-o/2)/(o/2)-.2)&&r<=1&&0!=i.volume&&(i.volume=r)),Math.abs(_vrect.top)>o||0==_vrect.height?this.pauseVideo(i,this.videoConfigs[n]):(t&&i.play(),i.paused&&i.loop&&i.play())}},e.prototype.getVideoObject=function(e){for(var t=0,o=this.videoTags.length;o<t;t++){var i=this.videoTags[t];if(i.v===e)return i}return null},e.prototype.getVideoBoundingRect=function(e,t){void 0===t&&(t=!0);return(t&&a(e).parents(".r")[0]||e).getBoundingClientRect()},window.videoLoadProcessor=new e}(jQuery);
